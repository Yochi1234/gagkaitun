--[[
    @author Enhanced Auto-Farm for Grow a Garden - PLAYER READY FIXED
    @description Fixed version with better player loading detection + v1415-style auto farm
    https://www.roblox.com/games/126884695634066
]]

-- Wait for game to load completely before doing anything
task.wait(3)

-- Check if we're in the right environment
if not game or not game.GetService then
    error("Script not running in proper Roblox environment")
    return
end

-- Safe service initialization with error handling
local function GetServiceSafely(serviceName)
    local success, service = pcall(function()
        return game:GetService(serviceName)
    end)
    if not success then warn(`Failed to get service: {serviceName}`) return nil end
    return service
end

-- Initialize services safely
local ReplicatedStorage = GetServiceSafely("ReplicatedStorage")
local Players = GetServiceSafely("Players")
local RunService = GetServiceSafely("RunService")
local TweenService = GetServiceSafely("TweenService")
local UserInputService = GetServiceSafely("UserInputService")

if not ReplicatedStorage or not Players or not RunService then
    error("Essential services not available - game may not be loaded")
    return
end

local LocalPlayer = Players.LocalPlayer
if not LocalPlayer then
    error("LocalPlayer not found - script may be running too early")
    return
end

-- Fix seed list (no Corn in v1415)
local SeedProgression = {
    {name = "Carrot", price = 5, unlock = 0},
    {name = "Tomato", price = 25, unlock = 500},
    {name = "Potato", price = 40, unlock = 1000},
    {name = "Watermelon", price = 80, unlock = 2500},
    {name = "Pumpkin", price = 150, unlock = 5000},
    {name = "Blueberry", price = 300, unlock = 10000},
}

local AutoEnabled = false
local AutoLoopConnection = nil
local ShecklesCount = nil
local InfoLabel, DebugLabel, ToggleButton, StatusLabel = nil

-- Return best seed by unlock value
local function GetBestSeed()
    local money = ShecklesCount and ShecklesCount.Value or 0
    for i = #SeedProgression, 1, -1 do
        if money >= SeedProgression[i].unlock then
            return SeedProgression[i].name
        end
    end
    return "Carrot"
end

-- Dummy: Replace with actual RemoteEvents
local function BuySeeds(seed)
    print("Buying seed:", seed)
end

local function PlantSeeds(seed)
    print("Planting seed:", seed)
end

local function HarvestCrops()
    print("Harvesting crops...")
end

local function SellCrops()
    print("Selling crops...")
end

-- Auto loop that mimics v1415-style
local function AutoFarmLoop()
    AutoLoopConnection = task.spawn(function()
        while AutoEnabled do
            local success = pcall(function()
                if ShecklesCount and InfoLabel then
                    InfoLabel.Text = `üí∞ Money: $${ShecklesCount.Value}`
                end
                if DebugLabel then
                    DebugLabel.Text = `üîß Seed: {GetBestSeed()}`
                end

                local seed = GetBestSeed()
                BuySeeds(seed)
                task.wait(1.5)
                PlantSeeds(seed)
                task.wait(1.5)
                HarvestCrops()
                task.wait(1.5)
                SellCrops()
                task.wait(1.5)
            end)
            if not success then
                StatusLabel.Text = "‚ùå Error occurred"
                task.wait(2)
            end
        end
    end)
end

local function ToggleAutoFarm()
    AutoEnabled = not AutoEnabled
    if AutoEnabled then
        ToggleButton.Text = "STOP AUTO FARM"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
        StatusLabel.Text = "üöÄ Auto-farm started"
        if AutoLoopConnection then task.cancel(AutoLoopConnection) end
        AutoFarmLoop()
    else
        ToggleButton.Text = "START AUTO FARM"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        StatusLabel.Text = "‚èπÔ∏è Auto-farm stopped"
        if AutoLoopConnection then task.cancel(AutoLoopConnection) AutoLoopConnection = nil end
    end
end

-- GUI Simulation (just buttons, for example)
ToggleButton = Instance.new("TextButton")
ToggleButton.Text = "START AUTO FARM"
StatusLabel = Instance.new("TextLabel")
InfoLabel = Instance.new("TextLabel")
DebugLabel = Instance.new("TextLabel")

ToggleButton.MouseButton1Click:Connect(function()
    local success = pcall(ToggleAutoFarm)
    if not success then warn("Failed to toggle auto-farm") end
end)

-- Fake value for money
ShecklesCount = Instance.new("IntValue")
ShecklesCount.Value = 0

print("‚úÖ v1415-style Auto-Farm script ready.")
